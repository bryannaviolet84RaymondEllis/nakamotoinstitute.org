[
    {
        "thread_id": 203,
        "name": "nelisky",
        "poster_url": "https://bitcointalk.org/index.php?action=profile;u=601",
        "subject": "auto backing up of wallet.dat",
        "url": "https://bitcointalk.org/index.php?topic=921.msg11107#msg11107",
        "date": "August 25, 2010, 03:52:13 AM",
        "content": "<div class=\"post\">So, as many others, I need to backup wallet.dat. And since this one is on a server, I need it to happen unattended. And because this server is being used by the lottery, I must not shutdown bitcoind.<br/><br/>So far I just copy the file over, and do it often so I can outlive one corrupted file. But this is not ideal, as I should backup after every transaction (sent, right? no new addresses are created on receiving a transfer ) or after everytime I create a new address.<br/><br/>For that I thought about instead of copying the file I could use db_dump to dump it's contents, using the -r flag just in case. Would that work?<br/><br/>The ideal solution would be an rpc call that would either:<br/>- flush and lock updates until a new rpc call (any call, didn't need to be an unlock command) would come over<br/>- flush and cp wallet.dat to a side file<br/>- flush and dump through jsonrpc. If each key would come separate in an array, we could then call this with 'lastseen=X' to just get new keys<br/><br/>Could this work? Which would work best?</div>",
        "post_num": 1,
        "is_displayed": true,
        "nested_level": 0
    },
    {
        "thread_id": 203,
        "name": "mizerydearia",
        "poster_url": "https://bitcointalk.org/index.php?action=profile;u=338",
        "subject": "Re: auto backing up of wallet.dat",
        "url": "https://bitcointalk.org/index.php?topic=921.msg11131#msg11131",
        "date": "August 25, 2010, 11:11:16 AM",
        "content": "<div class=\"post\"><a href=\"http://bitcointalk.org/index.php?topic=873.msg10728#msg10728\">http://bitcointalk.org/index.php?topic=873.msg10728#msg10728</a> is somewhat related</div>",
        "post_num": 2,
        "is_displayed": true,
        "nested_level": 0
    },
    {
        "thread_id": 203,
        "name": "satoshi",
        "poster_url": "https://bitcointalk.org/index.php?action=profile;u=3",
        "subject": "Re: auto backing up of wallet.dat",
        "url": "https://bitcointalk.org/index.php?topic=921.msg11228#msg11228",
        "date": "August 26, 2010, 12:57:40 AM",
        "content": "<div class=\"post\">I started posting in the other topic but I'll repeat here, this thread seems more specific to the topic.<br/><br/>The main backup improvement will be a pre-generated pool of keys and a rescan at load to scrape missed transactions from the block history.\u00a0 Then a backup will last forward for a long time.<br/><br/>I was starting to post the same idea you said nelisky.<br/><br/>How about a json-rpc command that locks the wallet, flushes it, copies wallet.dat to a location you specified, then unlocks it?\u00a0 That would be a smaller project than the pooled keys, so maybe it could be done first.<br/><br/>What's the simplest portable way to copy a file?\u00a0 Is there something in Boost?<br/><br/>What should it be named?\u00a0 maybe:<br/>backupwallet &lt;destination&gt;<br/><br/></div>",
        "post_num": 3,
        "is_displayed": true,
        "nested_level": 0
    },
    {
        "thread_id": 203,
        "name": "nelisky",
        "poster_url": "https://bitcointalk.org/index.php?action=profile;u=601",
        "subject": "Re: auto backing up of wallet.dat",
        "url": "https://bitcointalk.org/index.php?topic=921.msg11232#msg11232",
        "date": "August 26, 2010, 01:21:57 AM",
        "content": "<div class=\"post\"><div class=\"quoteheader\"><a href=\"https://bitcointalk.org/index.php?topic=921.msg11228#msg11228\">Quote from: satoshi on August 26, 2010, 12:57:40 AM</a></div><div class=\"quote\">I started posting in the other topic but I'll repeat here, this thread seems more specific to the topic.<br/><br/>The main backup improvement will be a pre-generated pool of keys and a rescan at load to scrape missed transactions from the block history.\u00a0 Then a backup will last forward for a long time.<br/><br/>I was starting to post the same idea you said nelisky.<br/></div><br/>Yes, I saw your other post and I really like the poll of addresses, but we still need a way to easily back up when those get all used, don't we? I know the address space is huge, but there might be applications that deliver thousands of addresses per day.<br/><br/><div class=\"quoteheader\"><a href=\"https://bitcointalk.org/index.php?topic=921.msg11228#msg11228\">Quote from: satoshi on August 26, 2010, 12:57:40 AM</a></div><div class=\"quote\"><br/>How about a json-rpc command that locks the wallet, flushes it, copies wallet.dat to a location you specified, then unlocks it?\u00a0 That would be a smaller project than the pooled keys, so maybe it could be done first.<br/><br/>What's the simplest portable way to copy a file?\u00a0 Is there something in Boost?<br/><br/>What should it be named?\u00a0 maybe:<br/>backupwallet &lt;destination&gt;<br/><br/><br/></div><br/>Great on all accounts, name and implementation approach. <br/><br/>As for the file copy, why add to the boost dependency? I for one would love to get a core lib with very little deps. In C++ you can just use standard file streams, can't you? Something like <a href=\"http://www.dreamincode.net/code/snippet2306.htm\">http://www.dreamincode.net/code/snippet2306.htm</a> (out of a quick google, didn't try but looks correct).<br/><br/>To put the cherry on top, why not add a trigger that makes the copy whenever there's a change to the wallet? Well, this would depend on file locking to work properly and that sucks on windows iirc. Been a while since I had to code there <img alt=\"Smiley\" border=\"0\" src=\"https://bitcointalk.org/Smileys/default/smiley.gif\"/></div>",
        "post_num": 4,
        "is_displayed": true,
        "nested_level": 0
    },
    {
        "thread_id": 203,
        "name": "jgarzik",
        "poster_url": "https://bitcointalk.org/index.php?action=profile;u=541",
        "subject": "Re: auto backing up of wallet.dat",
        "url": "https://bitcointalk.org/index.php?topic=921.msg11235#msg11235",
        "date": "August 26, 2010, 01:42:26 AM",
        "content": "<div class=\"post\"><div class=\"quoteheader\"><a href=\"https://bitcointalk.org/index.php?topic=921.msg11228#msg11228\">Quote from: satoshi on August 26, 2010, 12:57:40 AM</a></div><div class=\"quote\">What's the simplest portable way to copy a file?\u00a0 Is there something in Boost?<br/></div><br/>mmap(2) + memcpy(3) ?\u00a0 Boost::Iostreams already has a mapped_file Source.<br/><br/><div class=\"quoteheader\"><a href=\"https://bitcointalk.org/index.php?topic=921.msg11228#msg11228\">Quote from: satoshi on August 26, 2010, 12:57:40 AM</a></div><div class=\"quote\">What should it be named?\u00a0 maybe:<br/>backupwallet &lt;destination&gt;<br/></div><br/>Sounds quite useful!<br/><br/><br/><br/></div>",
        "post_num": 5,
        "is_displayed": true,
        "nested_level": 0
    },
    {
        "thread_id": 203,
        "name": "satoshi",
        "poster_url": "https://bitcointalk.org/index.php?action=profile;u=3",
        "subject": "Re: auto backing up of wallet.dat",
        "url": "https://bitcointalk.org/index.php?topic=921.msg11345#msg11345",
        "date": "August 27, 2010, 01:13:42 AM",
        "content": "<div class=\"post\">If you read it into memory and write it out, it could fail in tight memory situations. <br/><br/>I'm looking for something like copyfile(const char* from, const char* to) or copyfile(path from, path to), preferably something in Boost if it has it.\u00a0 If you find it for me, it's more likely I'll get to implementing it.<br/><br/><div class=\"quoteheader\"><a href=\"https://bitcointalk.org/index.php?topic=921.msg11232#msg11232\">Quote from: nelisky on August 26, 2010, 01:21:57 AM</a></div><div class=\"quote\">As for the file copy, why add to the boost dependency? I for one would love to get a core lib with very little deps.<br/></div>We require Boost for JSON and a dozen things replacing dependencies on wxWidgets.\u00a0 Boost is good, portable stuff, we should not shy away from it.</div>",
        "post_num": 6,
        "is_displayed": true,
        "nested_level": 0
    },
    {
        "thread_id": 203,
        "name": "nelisky",
        "poster_url": "https://bitcointalk.org/index.php?action=profile;u=601",
        "subject": "Re: auto backing up of wallet.dat",
        "url": "https://bitcointalk.org/index.php?topic=921.msg11346#msg11346",
        "date": "August 27, 2010, 01:21:09 AM",
        "content": "<div class=\"post\"><div class=\"quoteheader\"><a href=\"https://bitcointalk.org/index.php?topic=921.msg11345#msg11345\">Quote from: satoshi on August 27, 2010, 01:13:42 AM</a></div><div class=\"quote\">If you read it into memory and write it out, it could fail in tight memory situations. <br/><br/>I'm looking for something like copyfile(const char* from, const char* to) or copyfile(path from, path to), preferably something in Boost if it has it.\u00a0 If you find it for me, it's more likely I'll get to implementing it.<br/><br/><div class=\"quoteheader\"><a href=\"https://bitcointalk.org/index.php?topic=921.msg11232#msg11232\">Quote from: nelisky on August 26, 2010, 01:21:57 AM</a></div><div class=\"quote\">As for the file copy, why add to the boost dependency? I for one would love to get a core lib with very little deps.<br/></div>We require Boost for JSON and a dozen things replacing dependencies on wxWidgets.\u00a0 Boost is good, portable stuff, we should not shy away from it.<br/></div><br/>Ok, so what's wrong with the simple standard fstream usage from that snippet I mentioned? I think simple is best <img alt=\"Smiley\" border=\"0\" src=\"https://bitcointalk.org/Smileys/default/smiley.gif\"/><br/><br/>But if you are already using features from boost::filesystem you can use copy_file from that. I just think that, if not already required for something else, it's a tad overkill.</div>",
        "post_num": 7,
        "is_displayed": true,
        "nested_level": 0
    },
    {
        "thread_id": 203,
        "name": "jgarzik",
        "poster_url": "https://bitcointalk.org/index.php?action=profile;u=541",
        "subject": "Re: auto backing up of wallet.dat",
        "url": "https://bitcointalk.org/index.php?topic=921.msg11348#msg11348",
        "date": "August 27, 2010, 02:14:19 AM",
        "content": "<div class=\"post\"><div class=\"quoteheader\"><a href=\"https://bitcointalk.org/index.php?topic=921.msg11345#msg11345\">Quote from: satoshi on August 27, 2010, 01:13:42 AM</a></div><div class=\"quote\">If you read it into memory and write it out, it could fail in tight memory situations. <br/></div><br/>I think you misunderstand what mmap does?\u00a0 mmap / CreateFileMapping does not read a file into heap memory:\u00a0 <a href=\"http://en.wikipedia.org/wiki/Mmap\">http://en.wikipedia.org/wiki/Mmap</a><br/><br/></div>",
        "post_num": 8,
        "is_displayed": true,
        "nested_level": 0
    },
    {
        "thread_id": 203,
        "name": "satoshi",
        "poster_url": "https://bitcointalk.org/index.php?action=profile;u=3",
        "subject": "Re: auto backing up of wallet.dat",
        "url": "https://bitcointalk.org/index.php?topic=921.msg11350#msg11350",
        "date": "August 27, 2010, 02:54:07 AM",
        "content": "<div class=\"post\">I doubt there's an mmap(2) on Windows.\u00a0 I'd rather call an existing file copy function than make and test my own.<br/><br/><div class=\"quoteheader\"><a href=\"https://bitcointalk.org/index.php?topic=921.msg11346#msg11346\">Quote from: nelisky on August 27, 2010, 01:21:09 AM</a></div><div class=\"quote\">But if you are already using features from boost::filesystem you can use copy_file from that. I just think that, if not already required for something else, it's a tad overkill.<br/></div>Thanks.\u00a0 I thought it would be in there somewhere.<br/><br/>We already use boost::filesystem in a dozen places.\u00a0 It's not a new added dependency.\u00a0 It gives us a lot of portable stuff that we would otherwise have to have a #ifdef for each OS and test everywhere.<br/></div>",
        "post_num": 9,
        "is_displayed": true,
        "nested_level": 0
    },
    {
        "thread_id": 203,
        "name": "jgarzik",
        "poster_url": "https://bitcointalk.org/index.php?action=profile;u=541",
        "subject": "Re: auto backing up of wallet.dat",
        "url": "https://bitcointalk.org/index.php?topic=921.msg11352#msg11352",
        "date": "August 27, 2010, 03:42:25 AM",
        "content": "<div class=\"post\"><div class=\"quoteheader\"><a href=\"https://bitcointalk.org/index.php?topic=921.msg11350#msg11350\">Quote from: satoshi on August 27, 2010, 02:54:07 AM</a></div><div class=\"quote\">I doubt there's an mmap(2) on Windows.<br/></div><br/>The Windows version of mmap was mentioned in the message to which you replied:\u00a0 CreateFileMapping<br/><br/>In my earlier message, I mentioned how to use this from boost:\u00a0 Boost::Iostreams already has a mapped_file Source.<br/><br/></div>",
        "post_num": 10,
        "is_displayed": true,
        "nested_level": 0
    },
    {
        "thread_id": 203,
        "name": "satoshi",
        "poster_url": "https://bitcointalk.org/index.php?action=profile;u=3",
        "subject": "Re: auto backing up of wallet.dat",
        "url": "https://bitcointalk.org/index.php?topic=921.msg11399#msg11399",
        "date": "August 27, 2010, 03:47:57 PM",
        "content": "<div class=\"post\">Sorry, I've been so busy lately I've been skimming messages and I still can't keep up.<br/><br/>We want to avoid Windows API calls whenever possible. \u00a0They usually take about 6-8 parameters and a lot of testing to get right, it takes a page of code to do something simple.<br/><br/>I usually shy away from iostreams. \u00a0Seems like I too often hit limitations. \u00a0They kind of botched the C++ streams standard in the 90's, which is too bad, streams can be very powerful and useful when done right.\u00a0 Using it in rpc.cpp may still turn out to be a mistake.<br/><br/>Bottom line is I'd rather call an existing file copy function than make and test my own.</div>",
        "post_num": 11,
        "is_displayed": true,
        "nested_level": 0
    },
    {
        "thread_id": 203,
        "name": "satoshi",
        "poster_url": "https://bitcointalk.org/index.php?action=profile;u=3",
        "subject": "Re: auto backing up of wallet.dat",
        "url": "https://bitcointalk.org/index.php?topic=921.msg12134#msg12134",
        "date": "September 06, 2010, 09:45:10 PM",
        "content": "<div class=\"post\">rpc backupwallet &lt;destination&gt; is in SVN rev 147.</div>",
        "post_num": 12,
        "is_displayed": true,
        "nested_level": 0
    }
]